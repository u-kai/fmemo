
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Function Memo</title>
    <style>
        body {
            font-family: monospace;
            margin: 20px;
            background-color: #f5f5f5;
            padding: 20px;
        }
        .memo-container {
            border: 3px solid #333;
            margin: 15px;
            background-color: white;
            position: relative;
            border-radius: 8px;
            min-height: 60px;
        }
        .memo-header {
            padding: 15px 20px 10px 20px;
            border-bottom: 1px solid #eee;
            background-color: #fafafa;
            border-radius: 5px 5px 0 0;
        }
        .memo-title {
            font-weight: bold;
            margin: 0;
        }
        .memo-content {
            padding: 15px 20px;
            line-height: 1.6;
        }
        .memo-body {
            padding: 0px 20px 20px 20px;
        }
        .code-block {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        .code-block pre {
            margin: 0;
            white-space: pre-wrap;
        }
        .children-container {
            margin: 20px 15px 15px 15px;
        }
        
        /* Level-specific styling */
        .level-1 {
            border-color: #e74c3c;
            border-width: 4px;
            font-size: 1.1em;
        }
        .level-1 .memo-title { font-size: 1.4em; }
        
        .level-2 {
            border-color: #3498db;
            border-width: 3px;
            font-size: 1.05em;
        }
        .level-2 .memo-title { font-size: 1.2em; }
        
        .level-3 {
            border-color: #2ecc71;
            border-width: 3px;
        }
        .level-3 .memo-title { font-size: 1.1em; }
        
        .level-4 {
            border-color: #f39c12;
            border-width: 2px;
            font-size: 0.95em;
        }
        .level-4 .memo-title { font-size: 1.05em; }
        
        .level-5 {
            border-color: #9b59b6;
            border-width: 2px;
            font-size: 0.9em;
        }
        .level-5 .memo-title { font-size: 1.0em; }
        
        /* Deeper levels get smaller and more subtle */
        .level-6, .level-7, .level-8 {
            border-color: #95a5a6;
            border-width: 1px;
            font-size: 0.85em;
        }
        
        /* Collapsible functionality */
        .memo-header {
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s;
        }
        .memo-header:hover {
            background-color: #f0f0f0 !important;
        }
        .memo-title-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .expand-icon {
            font-size: 0.8em;
            color: #666;
            transition: transform 0.3s;
            user-select: none;
        }
        .expand-icon.expanded {
            transform: rotate(90deg);
        }
        .children-container {
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .children-container.collapsed {
            max-height: 0;
        }
        .children-container.expanded {
            max-height: 10000px; /* Large enough to show content */
        }
        .no-children .expand-icon {
            visibility: hidden;
        }
    </style>
    <script>
        const ws = new WebSocket('ws://localhost:3030/ws');
        ws.onmessage = function(event) {
            if (event.data === 'reload') {
                location.reload();
            }
        };
        
        function toggleMemo(element) {
            const container = element.parentElement;
            const childrenContainer = container.querySelector('.children-container');
            const icon = element.querySelector('.expand-icon');
            
            if (childrenContainer) {
                const isExpanded = childrenContainer.classList.contains('expanded');
                
                if (isExpanded) {
                    childrenContainer.classList.remove('expanded');
                    childrenContainer.classList.add('collapsed');
                    icon.classList.remove('expanded');
                } else {
                    childrenContainer.classList.remove('collapsed');
                    childrenContainer.classList.add('expanded');
                    icon.classList.add('expanded');
                }
            }
        }
        
        // Initialize all children as collapsed on page load
        document.addEventListener('DOMContentLoaded', function() {
            const childrenContainers = document.querySelectorAll('.children-container');
            childrenContainers.forEach(container => {
                container.classList.add('collapsed');
            });
        });
    </script>
</head>
<body>
<div class="memo-container level-1">
            <div class="memo-header" onclick="toggleMemo(this)">
                <div class="memo-title-container">
                    <span class="expand-icon">▶</span>
                    <h1 class="memo-title">Main Application - NESTED STRUCTURE TEST</h1>
                </div>
            </div>
<div class="memo-content">これはメインアプリケーションです。全体の処理を統括します。
入れ子構造が正しく動作していることを確認します。
</div>
<div class="memo-body"><div class="code-block">
                    <pre><code>fn main() {
    let app = App::new();
    app.run();
}</code></pre>
                    </div>
</div><div class="children-container"><div class="memo-container level-2">
            <div class="memo-header" onclick="toggleMemo(this)">
                <div class="memo-title-container">
                    <span class="expand-icon">▶</span>
                    <h2 class="memo-title">User Interface Module</h2>
                </div>
            </div>
<div class="memo-content">ユーザーインターフェースを管理するモジュールです。
</div>
<div class="memo-body"><div class="code-block">
                    <pre><code>mod ui {
    pub fn render_window() {
        // ウィンドウを描画
    }
}</code></pre>
                    </div>
</div><div class="children-container"><div class="memo-container level-3">
            <div class="memo-header" onclick="toggleMemo(this)">
                <div class="memo-title-container">
                    <span class="expand-icon">▶</span>
                    <h3 class="memo-title">Button Component</h3>
                </div>
            </div>
<div class="memo-content">ボタンコンポーネントの実装です。
</div>
<div class="memo-body"><div class="code-block">
                    <pre><code>struct Button {
    label: String,
    onclick: fn(),
}</code></pre>
                    </div>
</div><div class="children-container"><div class="memo-container level-4 no-children">
            <div class="memo-header" onclick="toggleMemo(this)">
                <div class="memo-title-container">
                    <span class="expand-icon">▶</span>
                    <h4 class="memo-title">Button Click Handler</h4>
                </div>
            </div>
<div class="memo-content">ボタンクリック時の処理です。
</div>
<div class="memo-body"><div class="code-block">
                    <pre><code>impl Button {
    fn handle_click(&amp;self) {
        (self.onclick)();
    }
}</code></pre>
                    </div>
</div></div>
</div></div>
<div class="memo-container level-3 no-children">
            <div class="memo-header" onclick="toggleMemo(this)">
                <div class="memo-title-container">
                    <span class="expand-icon">▶</span>
                    <h3 class="memo-title">Menu Component</h3>
                </div>
            </div>
<div class="memo-content">メニューコンポーネントです。
</div>
<div class="memo-body"><div class="code-block">
                    <pre><code>struct Menu {
    items: Vec&lt;MenuItem&gt;,
}</code></pre>
                    </div>
</div></div>
</div></div>
<div class="memo-container level-2">
            <div class="memo-header" onclick="toggleMemo(this)">
                <div class="memo-title-container">
                    <span class="expand-icon">▶</span>
                    <h2 class="memo-title">Database Module</h2>
                </div>
            </div>
<div class="memo-content">データベース操作を行うモジュールです。
</div>
<div class="memo-body"><div class="code-block">
                    <pre><code>mod database {
    pub fn connect() -&gt; Connection {
        // データベースに接続
    }
}</code></pre>
                    </div>
</div><div class="children-container"><div class="memo-container level-3">
            <div class="memo-header" onclick="toggleMemo(this)">
                <div class="memo-title-container">
                    <span class="expand-icon">▶</span>
                    <h3 class="memo-title">User Repository</h3>
                </div>
            </div>
<div class="memo-content">ユーザー情報を管理するリポジトリです。
</div>
<div class="memo-body"><div class="code-block">
                    <pre><code>struct UserRepository {
    connection: Connection,
}</code></pre>
                    </div>
</div><div class="children-container"><div class="memo-container level-4">
            <div class="memo-header" onclick="toggleMemo(this)">
                <div class="memo-title-container">
                    <span class="expand-icon">▶</span>
                    <h4 class="memo-title">CRUD Operations</h4>
                </div>
            </div>
<div class="memo-content">基本的なCRUD操作です。
</div>
<div class="memo-body"><div class="code-block">
                    <pre><code>impl UserRepository {
    fn create_user(&amp;self, user: User) -&gt; Result&lt;(), Error&gt; {
        // ユーザーを作成
    }
    
    fn find_user(&amp;self, id: i32) -&gt; Option&lt;User&gt; {
        // ユーザーを検索
    }
}</code></pre>
                    </div>
</div><div class="children-container"><div class="memo-container level-5 no-children">
            <div class="memo-header" onclick="toggleMemo(this)">
                <div class="memo-title-container">
                    <span class="expand-icon">▶</span>
                    <h5 class="memo-title">User Validation</h5>
                </div>
            </div>
<div class="memo-content">ユーザーデータの検証ロジックです。
</div>
<div class="memo-body"><div class="code-block">
                    <pre><code>fn validate_user(user: &amp;User) -&gt; bool {
    !user.email.is_empty() &amp;&amp; user.age &gt; 0
}</code></pre>
                    </div>
</div></div>
</div></div>
</div></div>
</div></div>
<div class="memo-container level-2 no-children">
            <div class="memo-header" onclick="toggleMemo(this)">
                <div class="memo-title-container">
                    <span class="expand-icon">▶</span>
                    <h2 class="memo-title">Configuration Module</h2>
                </div>
            </div>
<div class="memo-content">設定を管理するモジュールです。
</div>
<div class="memo-body"><div class="code-block">
                    <pre><code>mod config {
    pub fn load_config() -&gt; Config {
        // 設定ファイルを読み込み
    }
}</code></pre>
                    </div>
</div></div>
</div></div>
</body>
</html>